(function(r,c){typeof exports=="object"&&typeof module!="undefined"?c(exports,require("path-browserify"),require("json5")):typeof define=="function"&&define.amd?define(["exports","path-browserify","json5"],c):(r=typeof globalThis!="undefined"?globalThis:r||self,c(r.MCProjectCore={},r.pathBrowserify,r.json5))})(this,function(r,c,C){"use strict";function F(h){return h&&typeof h=="object"&&"default"in h?h:{default:h}}var b=F(C);class x{constructor(e){this.projectConfig=e,this.packTypes=[],this.extensionPackTypes=new Set}get all(){return this.packTypes.concat(...Array.from(this.extensionPackTypes.values()))}getFromId(e){return this.all.find(t=>t.id===e)}get(e){const t=this.projectConfig.getAvailablePacks();for(const s in t)if(e.startsWith(t[s]))return this.getFromId(s)}getId(e){var t,s;return(s=(t=this.get(e))==null?void 0:t.id)!=null?s:"unknown"}addExtensionPackType(e){return this.extensionPackTypes.add(e),{dispose:()=>this.extensionPackTypes.delete(e)}}}class w{constructor(e,t){this.projectConfig=e,this.isMatch=t,this.pluginFileTypes=new Set,this.fileTypes=[]}get all(){return this.fileTypes.concat([...this.pluginFileTypes.values()])}setProjectConfig(e){this.projectConfig=e}addPluginFileType(e){return this.pluginFileTypes.add(e),{dispose:()=>this.pluginFileTypes.delete(e)}}getPluginFileTypes(){return[...this.pluginFileTypes.values()]}setPluginFileTypes(e=[]){this.pluginFileTypes.clear(),e.forEach(t=>this.pluginFileTypes.add(t))}get(e,t){var o,l,u,n,a,p,f,g,y,P,k,T,j;const s=e?c.extname(e):null;for(const i of this.all){if(t!==void 0&&t===i.id)return i;if(!e)continue;const v=((o=i.detect)==null?void 0:o.packType)===void 0?[]:Array.isArray((l=i.detect)==null?void 0:l.packType)?(u=i.detect)==null?void 0:u.packType:[(n=i.detect)==null?void 0:n.packType],m=(a=i.detect)==null?void 0:a.fileExtensions,M=!!((p=i.detect)==null?void 0:p.scope),S=Array.isArray((f=i.detect)==null?void 0:f.scope)?(g=i.detect)==null?void 0:g.scope:[(y=i.detect)==null?void 0:y.scope],E=!!((P=i.detect)==null?void 0:P.matcher),W=Array.isArray((k=i.detect)==null?void 0:k.matcher)?(T=i.detect)==null?void 0:T.matcher:[(j=i.detect)==null?void 0:j.matcher];if(!(m&&s&&!m.includes(s)))if(M){if(this.prefixMatchers(v,S).some(_=>e.startsWith(_)))return i}else if(E){if(this.isMatch(e,this.prefixMatchers(v,W)))return i}else throw console.log(i),new Error('Invalid file definition, no "detect" properties')}}prefixMatchers(e,t){if(!this.projectConfig)return[];if(e.length===0)return t.map(o=>this.projectConfig.resolvePackPath(void 0,o));const s=[];for(const o of e)for(const l of t)s.push(this.projectConfig.resolvePackPath(o,l));return s}getIds(){const e=[];for(const t of this.all)e.push(t.id);return e}async guessFolder(e){var u;const t=n=>{let a=Array.isArray(n)?n[0]:n;return a.endsWith("/")||(a+="/"),a},s=`.${e.name.split(".").pop()}`;for(const{detect:n={}}of this.all)if(!!n.scope&&((u=n.fileExtensions)==null?void 0:u.includes(s)))return t(n.scope);if(!e.name.endsWith(".json"))return null;const o=await e.getFile();let l;try{l=b.default.parse(await o.text())}catch{return null}for(const{type:n,detect:a}of this.all){if(typeof n=="string"&&n!=="json")continue;const{scope:p,fileContent:f}=a!=null?a:{};if(!(!p||!f))return t(p)}return null}getId(e){var t,s;return(s=(t=this.get(e))==null?void 0:t.id)!=null?s:"unknown"}isJsonFile(e){var s,o;const t=(o=(s=this.get(e))==null?void 0:s.meta)==null?void 0:o.language;return t?t==="json":e.endsWith(".json")}}const d={behaviorPack:"./BP",resourcePack:"./RP",skinPack:"./SP",worldTemplate:"./WT"};class A{constructor(e){this.basePath=e,this.data={}}async refreshConfig(){try{this.data=await this.readConfig()}catch{this.data={}}}async setup(){await this.refreshConfig()}get(){return this.data}getPackRoot(e){var t,s;return(s=(t=this.data.packs)==null?void 0:t[e])!=null?s:d[e]}resolvePackPath(e,t){return!t&&!e?this.basePath:!e&&t?c.join(this.basePath,t):!t&&e?c.resolve(this.basePath,`${this.getPackRoot(e)}`):c.resolve(this.basePath,`${this.getPackRoot(e)}/${t}`)}getAvailablePackPaths(){var t;const e=[];for(const s of Object.keys((t=this.data.packs)!=null?t:{}))e.push(this.resolvePackPath(s));return e}getAvailablePacks(){var t;const e={};for(const s in(t=this.data.packs)!=null?t:{})e[s]=this.resolvePackPath(s);return e}async save(){await this.writeConfig(this.data)}}r.FileType=w,r.PackType=x,r.ProjectConfig=A,r.defaultPackPaths=d,Object.defineProperty(r,"__esModule",{value:!0}),r[Symbol.toStringTag]="Module"});
